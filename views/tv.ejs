
<body style="background-color: #0D1D3A">
   <!-- ========== Start header ========== -->
<%-include("layouts/header.ejs")%>
<!-- ========== End header ========== --> 
<div class="tv-header">
<div class="center_div tv-items">
   
    <div class="tv-items-one">
        <div class="bid_head">
            <span>OZ</span><span>BID</span><span>USD</span>
        </div>
        <div class="tv-items-data">
            <h3>GOLD</h3>
            <h2 class="tv_data_green" id="data-container2">---</h2>
            <div style="display: flex;justify-content: center;">
                <p>Low -</p>
                <p id="data-low"></p>
              </div>
        </div>
    </div>

    <div class="tv-items-one">
        <div class="bid_head">
            <span>OZ</span><span>ASK</span><span>USD</span>
        </div>
        <div class="tv-items-data">
            <h3>GOLD</h3>
            <h2 class="tv_data_green" id="data-container1">---</h2>
            <div style="display: flex;justify-content: center;">
                <p>HIGH -</p>
                <p id="data-high"></p>
              </div>
        </div>
    </div>
    
    <div class="tv-items-one tv_bg_none">
        <div><img src="/images/ACE Gold Logo Transparent.png" alt=""  ></div>
    </div>  
    <div class="market-data" id="market_data_items">
        <i class="fa fa-exclamation-circle warning-icon"></i>
        Market Closed
      </div>
</div>

<!-- ========== Start table ========== -->
<div class="tv-items-table">
    
    <div class="tv-items-tableone">
 <div class="bid_head_table">
    <span>WEIGHT</span><span>(GOLD)</span><span>(AED)</span>
   <div class="tv_table_data_items">
    <div class="tv_table_data">
        <div class="table_data_weight">TT BAR</div>
        <div class="table_border"></div>
    <div class="table_data_aed" id="gold">---</div>
    </div>
    <div class="tv_table_data">
        <div class="table_data_weight">995 1KG</div>
        <div class="table_border"></div>
    <div class="table_data_aed" id="gold995">---</div>
    </div>
   </div>
    </div>
    </div>
   
    <div class="tv-items-tableone">
        <div class="bid_head_table">
           <span>WEIGHT</span><span>(GOLD)</span><span>(AED)</span>
          <div class="tv_table_data_items">
           <div class="tv_table_data">
               <div class="table_data_weight">1 GRAM</div>
               <div class="table_border"></div>
           <div class="table_data_aed" id="gold9999gm">---</div>
           </div>
           <div class="tv_table_data">
               <div class="table_data_weight">9999 1KG</div>
               <div class="table_border"></div>
           <div class="table_data_aed" id="gold9999"></div>
           </div>
          </div>
           </div>
           </div>
   <div class="table_data_silver"><h2>SILVER 1KG</h2> <h2 id="silver"></h2></div>
    </div>
    
<!-- ========== End table ========== -->
</div>
<script>
    const socketUrl = "https://walrus-app-k59sj.ondigitalocean.app?franchiseId=646c8c2d66d5379aede9313f";
    const socket = io(socketUrl, {
      transports: ["websocket"],
      withCredentials: true
    });

    //for using  if-else
    let stockPriceHigh = document.getElementById('data-container1');
    let lastPriceHigh = null;

    let stockPriceLow = document.getElementById('data-container2');
    let lastPriceLow = null;

    socket.on("connect", () => {
      console.log("Connected to the server");
    });

    // Listen for "message" event from the server
    socket.on("message", (data) => {
      console.log(data);
      let market = document.getElementById('market_data_items')
      market.style.display = 'none';

      if (!data.MARKET) {
        let market = document.getElementById('market_data_items')
        market.style.display = 'block';
        market.style.color = 'red';
      }

      //price-high
      let dataPriceHigh = document.getElementById('data-high');
      let highPrice = parseFloat(data.XAUUSD.high).toFixed(2);
      dataPriceHigh.innerText = highPrice;

      //price-low
      let dataPriceLow = document.getElementById('data-low');
      let lowprice = parseFloat(data.XAUUSD.low).toFixed(2);
      dataPriceLow.innerText = lowprice;

      //fixed-price high
      let priceHigh = parseFloat(data.XAUUSD.ask - data.COMMONBUY).toFixed(2); // Get the price with 2 decimal places
      priceHigh = parseFloat(priceHigh).toLocaleString();
      if (!lastPriceHigh || lastPriceHigh === priceHigh) {
        stockPriceHigh.style.color = 'white';
      } else if (priceHigh > lastPriceHigh) {
        stockPriceHigh.style.color = 'green';
      } else {
        stockPriceHigh.style.color = 'red';
      }
      stockPriceHigh.innerText = priceHigh;
      lastPriceHigh = priceHigh;

      // fixed-price low
      let priceLow = parseFloat(data.XAUUSD.bid - data.COMMONSELL).toFixed(2);
      priceLow = parseFloat(priceLow).toLocaleString();
      if (!lastPriceLow || lastPriceLow === priceLow) {
        stockPriceLow.style.color = 'white';
      } else if (priceLow > lastPriceLow) {
        stockPriceLow.style.color = 'green';
      } else {
        stockPriceLow.style.color = 'red';
      }
      stockPriceLow.innerText = priceLow;
      lastPriceLow = priceLow;


      // Assuming data.XAUUSD.bid is a valid number and data.GOLD995 is a valid number in string format

      // Parse the socketvalue in socket
      let goldPriceData = parseFloat(data.XAUUSD.ask);
      let silverPriceData = parseFloat(data.XAGUSD.ask);

      // Conversion rates
      const usdPrice = 3.6725;
      const aedPrice = 0.03215074;

      // Calculate the goldData1 value
      const goldData1 = parseFloat(goldPriceData) * (usdPrice * aedPrice * 995) + (parseFloat(data.COMMONBUY) + parseFloat(data.GOLD995));
      const goldData2 = parseFloat(goldPriceData) * (usdPrice * aedPrice * 999.9) + (parseFloat(data.COMMONBUY) + parseFloat(data.GOLD9999));
      const goldData3 = parseFloat(goldPriceData) * (usdPrice * aedPrice * 116.664) + (parseFloat(data.COMMONBUY) + parseFloat(data.GOLD));
      const goldData4 = parseFloat(goldPriceData) * (usdPrice * aedPrice) + (parseFloat(data.COMMONBUY) + parseFloat(data.GOLD9999GM));
      const silverData = parseFloat(silverPriceData) * (usdPrice * aedPrice * 1000) + (parseFloat(data.COMMONBUY) + parseFloat(data.SILVER));

      // Display the calculated values in the HTML element
      const gold995Element = document.getElementById('gold995');
      gold995Element.innerText = goldData1.toLocaleString();
      gold995Element.style.color = determineColor(gold995Element, goldData1);

      const gold9999Element = document.getElementById('gold9999');
      gold9999Element.innerText = goldData2.toLocaleString();
      gold9999Element.style.color = determineColor(gold9999Element, goldData2);

      const goldElement = document.getElementById('gold');
      goldElement.innerHTML = goldData3.toLocaleString();
      goldElement.style.color = determineColor(goldElement, goldData3);

      const gold9999gmElement = document.getElementById('gold9999gm');
      gold9999gmElement.innerHTML = goldData4.toLocaleString();
      gold9999gmElement.style.color = determineColor(gold9999gmElement, goldData4);

      const silverElement = document.getElementById('silver');
      silverElement.innerHTML = silverData.toLocaleString();
      silverElement.style.color = determineColor(silverElement, silverData);


      function determineColor(element, value) {
        const previousValue = parseFloat(element.textContent);

        if (value > previousValue) {
          return 'green'; // Increase, set color to green
        } else if (value < previousValue) {
          return 'red'; // Decrease, set color to red
        } else {
          return 'black';
        }
      }

    });

    // Handle disconnect event
    socket.on("disconnect", () => {
      console.log("Disconnected from the server");
    });
  </script>
  <%-include("layouts/footer.ejs")%>
</body>